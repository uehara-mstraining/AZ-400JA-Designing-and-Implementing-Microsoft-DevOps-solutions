---
lab:
  title: "ラボ: Azure Repos での Git によるバージョン管理"
  module: "モジュール 2: ソース管理の開始"
---

# ラボ: Azure Repos の Git によるバージョン管理

# 学生用ラボ マニュアル

## ラボの概要

Azure DevOps は、Git と Team Foundation バージョン管理 (TFVC) の 2 種類のバージョン管理をサポートしています。2 つのバージョン管理システムの概要は次のとおりです。

- **Team Foundation バージョン管理 (TFVC)**: TFVC は集中型バージョン管理システムです。通常、チームメンバーの開発マシンに、各ファイルには 1 つのバージョンしかありません。履歴データはサーバー上でのみ保持されます。ブランチはパスベースであり、サーバー上に作成されます。

- **Git**: Git は分散型バージョン管理システムです。Git リポジトリはローカルに存在できます (開発者のマシンなど)。各開発者は、開発マシンにソース リポジトリのコピーを持っています。開発者は、開発マシンで変更の各セットをコミットし、履歴などのバージョン管理操作を実行し、ネットワークに接続せずに比較することが可能です。

Git は、新しいプロジェクトの既定のバージョン管理プロバイダーです。TFVC で集中型バージョン管理機能が特に必要な場合を除いて、プロジェクトのバージョン管理には Git を使用する必要があります。

このラボでは、Azure DevOps の集中型 Git リポジトリと簡単に同期できるローカル Git リポジトリを確立する方法を学びます。さらに、Git のブランチとマージのサポートについても学びます。Visual Studio Code を使用しますが、Git 互換クライアントの使用にも同じプロセスが適用されます。

## 目標

このラボを完了すると、次のことができるようになります。

- 既存のリポジトリを複製する
- コミットで作業を保存する
- 変更の履歴をレビューする
- Visual Studio Code を使用してブランチを操作する

## ラボの所要時間

- 推定時間: **50 分**

## 手順

### 開始する前に

#### ラボの仮想マシンにログインする

次の認証情報を使用して、Windows 10 仮想マシンにサインインしていることを確認します。

- ユーザー名: **Student**
- パスワード: **Pa55w.rd**

#### このラボに必要なアプリケーションを確認する

このラボで使用するアプリケーションを特定する:

- Microsoft Edge
- [Git for Windows ダウンロード ページ](https://gitforwindows.org/)。これは、このラボの前提条件の一部としてインストールされます。
- [Visual Studio Code](https://code.visualstudio.com/)。これは、このラボの前提条件の一部としてインストールされます。

#### Azure DevOps 組織を設定する

このラボで使用できる Azure DevOps 組織がまだない場合は、[組織またはプロジェクトコレクションの作成](https://docs.microsoft.com/ja-jp/azure/devops/organizations/accounts/create-organization?view=azure-devops)の手順に従って作成してください。

### 演習 0: ラボの前提条件を構成する

この演習では、ラボの前提条件を設定します。これには、Azure DevOps Demo Generator テンプレートと Visual Studio Code 構成に基づいて事前構成された Parts Unlimited チーム プロジェクトが含まれます。

#### タスク 1: Parts Unlimited チームプ ロジェクトを構成する

このタスクでは、Azure DevOps Demo Generator を使用して、**Parts Unlimited** テンプレート基づいて新しいプロジェクトを生成します。

1.  ラボ コンピューターで、Web ブラウザーを起動し、[Azure DevOps Demo Generator](https://azuredevopsdemogenerator.azurewebsites.net) に移動します。このユーティリティ サイトは、ラボに必要なコンテンツ (作業項目、リポジトリなど) が事前に入力されたアカウント内に新しい Azure DevOps プロジェクトを作成するプロセスを自動化します。

    > **注**: サイトの詳細については、https://docs.microsoft.com/ja-jp/azure/devops/demo-gen を参照してください。

1.  「**サインイン**」 をクリックし、Azure DevOps サブスクリプションに関連付けられている Microsoft アカウントを使用してサインインします。
1.  必要な場合は、**Azure DevOps Demo Generator** ページで、「**承諾する**」 をクリックして、Azure DevOps サブスクリプションにアクセスするためのアクセス許可の要求を受け入れます。
1.  「**Create a new project**」 ページの 「**New Project Name**」 テキストボックスに、「**Version Controlling with Git in Azure Repos**」と入力し、「**Select organization**」 ドロップダウン リストで、Azure DevOps 組織を選択して、「**Choose a template**」 をクリックします。
1.  テンプレートのリストで、**PartsUnlimited** テンプレートを見つけ、「**Choose a template**」 をクリックします。
1.  「**Create New Project**」 ページで、「**Create Project**」 をクリックします

    > **注**: プロセスが完了するまでお待ちください。これにはおよそ 2 分かかります。プロセスが失敗した場合は、DevOps 組織に移動し、プロジェクトを削除して、再試行してください。

1.  「**Create New Project**」 ページで、「**Navigate to project**」 をクリックします

#### タスク 2: Git および Visual Studio Code のインストールと構成

このタスクでは、Git および Visual Studio Code をインストールおよび構成します。これには、Azure DevOps との通信に使用される Git 資格情報を安全に保存するための Git 資格情報ヘルパーの構成も含まれます。これらの前提条件をすでに実装している場合は、次のタスクに直接進むことができます。

1.  Git 2.29.2 以降をまだインストールしていない場合は、Web ブラウザーを起動し、「Git for Windows のダウンロード ページ」(https://gitforwindows.org/)に移動してダウンロードし、インストールします。
1.  Visual Studio Code をまだインストールしていない場合は、Web ブラウザー ウィンドウから [Visual Studio Code ダウンロード ページ](https://code.visualstudio.com/)に移動し、ダウンロードしてインストールします。
1.  Visual Studio C# 拡張機能をまだインストールしていない場合は、Web ブラウザー ウィンドウで、[C# 拡張機能のインストール ページ](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)に移動してインストールします。
1.  ラボ コンピューターで、**Visual Studio Code** を開きます。
1.  Visual Studio Code インターフェイスで、メイン メニューから、「**ターミナル \| 新しいターミナル**」 を選択して 「**ターミナル**」 ペインを開きます。
1.  「**ターミナル**」 ペインの右上隅にあるドロップダウン リストに **1: powershell** 表示されているかどうかを確認して、現在のターミナルが **PowerShell** を実行していることを確認します

    > **注**: 現在のターミナル シェルを **PowerShell** に変更するには、「**ターミナル**」 ペインの右上隅のドロップダウン リストをクリックし、「**デフォルト シェルの選択**」 をクリックします。Visual Studio Code ウィンドウの上部で、使用するターミナル シェル **Windows PowerShell** を選択し、ドロップダウン リストの右側にあるプラス記号をクリックして、選択したデフォルト シェルで新しいターミナルを開きます。

1.  「**ターミナル**」 ペインで、以下のコマンドを実行して、資格情報ヘルパーを構成します。

    ```git
    git config --global credential.helper wincred
    ```

1.  「**ターミナル**」 ペインで、次のコマンドを実行して、Git コミットのユーザー名とメールアドレスを設定します (中括弧内のプレース ホルダーをユーザー名とメールアドレスに置き換えます)。

    ```git
    git config --global user.name "<John Doe>"
    git config --global user.email <johndoe@example.com>
    ```

### 演習 1: 既存のリポジトリを複製する

この演習では、Visual Studio Code を使用して、前の演習の一部としてプロビジョニングした Git リポジトリのクローンを作成します。

#### タスク 1: 既存のリポジトリを複製する

このタスクでは、Visual Studio Code を使用して Git リポジトリを複製するプロセスを順を追って説明します。

1.  前の演習で生成した **Version Controlling with Git in Azure Repos**プロジェクトをブラウザで開きます。

1.  Azure DevOps ポータルの垂直ナビゲーション ペインで、「**Repos**」 アイコンを選択します。

1. 画面の右上にある **Clone** をクリックします。

    > **注**: Git リポジトリのローカル コピーを取得することを*クローン作成*と呼びます。すべての主流の開発ツールはこれをサポートしており、Azure Repos に接続して、最新のソースをプル ダウンして操作できるようになります。

1.  「**Clone Repository**」 パネルで、**HTTPS** コマンドライン オプションを選択した状態で、 URL の横にある 「**Copy to clipboard**」 アイコンをクリックします。

    > **注**: この URL を Git 互換ツールで使用して、コードベースのコピーを取得できます。

1.  「**Clone Repository**」 パネルを閉じます。

1.  ラボ コンピューターで実行されている **Visual Studio Code** に切り替えます。
1.  「**View(表示)**」 メニューをクリックし、ドロップダウン メニューで 「**Cpmmand Palette(コマンド パレット)**」 をクリックします。

    > **注**: コマンド パレットは、サードパーティの拡張機能として実装されているタスクを含む、さまざまなタスクにアクセスするための簡単で便利な方法を提供します。キーボード ショートカットの **Ctrl+Shift+P** または **F1** を使用して開くことができます。

1.  コマンド パレット プロンプトで、**Git: Clone** コマンドを実行します。

    > **注**: 関連するすべてのコマンドを表示するには、**Git** と入力します。

1.  「**Provide repository URL or pick a repository source**」 テキストボックスで、このタスクの前半でコピーしたリポジトリ クローン URL を貼り付け、**Enter** キーを押します。
1.  「**Select Folder(フォルダーの選択)**」 ダイアログボックスで、C: ドライブに移動し、Git という名前の新しいフォルダーを作成して選択し、「**Select Repository Location(リポジトリの場所の選択)**」 をクリックします。
1.  プロンプトが表示されたら、Azure DevOps アカウントにログインします。
    > Password は、「**Clone Repository**」 パネルの「Generate Git Credentials」から取得可能です。
1.  クローン作成プロセスが完了したら、右下にプロンプトが表示されたら、Visual Studio Code で 「**Open**」 をクリックして、複製されたリポジトリを開きます。

    > **注**: プロジェクトのロードに関する問題に関して受け取る可能性のある警告は無視してかまいません。ソリューションはビルドに適した状態ではない可能性がありますが、Git での作業に重点を置くため、プロジェクトのビルドは必要ありません。

### 演習 2: コミットで作業を保存する

この演習では、Visual Studio Code を使用して変更をステージングおよびコミットすることを含むいくつかのシナリオを順を追って説明します。

ファイルに変更を加えると、Git はその変更をローカル リポジトリに記録します。ステージングすることにより、コミットする変更を選択できます。コミットは常にローカル Git リポジトリに対して行われるため、コミットが完全であるか、他のユーザーと共有する準備ができているかを心配する必要はありません。作業を続けながらコミットを増やし、共有の準備ができたら変更を他の人にプッシュできます。

Git コミットは、次のもので構成されます。

- コミットで変更されたファイル。Git は、リポジトリ内のすべてのファイル変更の内容をコミットに保持します。これにより、高速が維持され、インテリジェントなマージが可能になります。
- 親コミットへの参照。Git は、これらの参照を使用してコード履歴を管理します。
- コミットを説明するメッセージ。コミットを作成するときに、このメッセージを Git に渡します。このメッセージを説明的なものにしておくことをお勧めしますが、要点を説明します。

#### タスク 1: 変更をコミットする

このタスクでは、Visual Studio Code を使用して変更をコミットします。

1.  Visual Studio Code ウィンドウの垂直ツールバーの上部にある 「**EXPLORER**」 タブを選択し、**/PartsUnlimited-aspnet45/src/PartsUnlimitedWebsite/Models/CartItem.cs** ファイルに移動して選択します。これにより、コンテンツが詳細ペインに自動的に表示されます。
1.  **CartItem.cs** ファイルの `[key]` のすぐ上に、次のコメントを含む追加の行を追加します。

    ```csharp
    // My first change
    ```

    > **注**: コメントが何であるかは実際には問題ではありません。目標は、変更を加えることだけです。

1.  **Ctrl+S** を押して変更を保存します。
1.  Visual Studio Code ウィンドウで、左側にある「**Source Control(ソース管理)**」 タブを選択して、Git が Git リポジトリのローカル クローンにあるファイルへの最新の変更を認識したことを確認します。
1.  ペインの上部にあるテキストボックスに、コミットメッセージとして「**My commit**」と入力し、**Ctrl+Enter** を押してローカルでコミットします。
1.  変更を自動的にステージングして直接コミットするかどうかを確認するメッセージが表示されたら、「**Always**」 をクリックします。

    > **注**: **ステージング**については、ラボの後半で説明します。

1.  Visual Studio Code ウィンドウの左下隅の**master** ラベルの右側にある、反対方向を指す 2 つの垂直矢印 アイコンを確認します。以降、このアイコンを「**変更の同期**」 ボタンと呼びます。「**変更の同期**」 ボタンをクリックし、プロンプトが表示されたら、続行するかどうかを選択し、「**OK**」をクリックして、**origin/master**との間でコミットをプッシュおよびプルします。

#### タスク 2: コミットの確認

このタスクでは、Azure DevOps ポータルを使用してコミットを確認します。

1.  Azure DevOps インターフェイスを表示する Web ブラウザー ウィンドウに切り替えます。
1.  Azure DevOps ポータルの垂直ナビゲーション ペインの 「**Repos**」 セクションで、「**Commits**」 を選択します。
1.  コミットがリストの一番上に表示されることを確認します。

#### タスク 3: ステージの変更

このタスクでは、Visual Studio Code を 使用してステージングの変更の使用方法を検討します。ステージングの変更により、他のファイルで行われた変更を渡しながら、特定のファイルを選択的にコミットに追加できます。

1.  **Visual Studio Code** ウィンドウに戻ります。
1.  最初のコメントを `// My second change` に変更し、ファイルを保存して **CartItem.cs** クラスを更新します。
1.  Visual Studio Code ウィンドウで、「**EXPLORER**」 **/PartsUnlimited-aspnet45/src/PartsUnlimitedWebsite/Models/Category.cs** ファイルに移動して選択します。
1.  **Category.cs** ファイルの `public int CategoryId { get; set; }` エントリのすぐ上に次のコメントを含む行を追加し、ファイルを保存します。

    ```csharp
    // My third change
    ```

1.  Visual Studio Code ウィンドウで、「**Source Control(ソース管理)**」 タブに切り替え、**CartItem.cs** エントリの上にマウス ポインタを置いて、そのエントリの右側にあるプラス(+)記号をクリックします。

    > **注**: これにより、**CartItem.cs** ファイルへの変更のみが**ステージング**され、**Category.cs** なしでコミットできるように準備されます。

1.  ペインの上部にあるテキストボックスに「**Added comments**」と入力します。
1.  「**ソース管理**」 タブの上部にある省略記号をクリックし、ドロップダウンメニューで 「**Commit**」 を選択し、カスケード メニューで 「**Commit Staged**」 を選択します。
1.  Visual Studio Code ウィンドウの左下隅にある 「**変更の同期**」 ボタンをクリックして、コミットされた変更をサーバーと同期し、続行するかどうかを確認するメッセージが表示されたら、「**OK**」 をクリックして、**origin/master**との間でコミットをプッシュおよびプルします。

    > **注**: 段階的な変更のみがコミットされたため、他の変更は同期が保留されていることに注意してください。

### 演習 3: 履歴の確認

この演習では、Azure DevOps ポータルを使用して、コミットの履歴を確認します。

Git は、各コミットに保存されている親参照情報を使用して、開発の完全な履歴を管理します。このコミット履歴を簡単に確認して、ファイルの変更がいつ行われたかを確認し、ターミナルを使用して、または利用可能な多くの Visual Studio Code 拡張機能の 1 つからコードのバージョン間の違いを判断できます。Azure DevOps ポータルを使用して変更を確認することもできます。

Git による**ブランチとマージ**機能の使用は Pull request を介して機能するため、開発のコミット履歴は必ずしも直線的な時系列を形成するとは限りません。履歴を使用してバージョンを比較するときは、2 つの時点間のファイルの変更ではなく、2 つのコミット間のファイルの変更の観点から考えてください。master ブランチのファイルに対する最近の変更は、昨日マージされた機能ブランチで 2 週間前に作成されたコミットに起因している可能性があります。

#### タスク 1: ファイルを比較する

このタスクでは、Azure DevOps ポータルを使用して、コミット履歴を順を追って説明します。

1.  Visual Studio Code ウィンドウの 「**ソース管理**」 タブを開いた状態で、 **Category.cs** を選択します。

    > **注**: 比較ビューが開かれ、行った変更を簡単に見つけることができます。この場合、それはただ 1 つのコメントです。

1.  **Azure DevOps** ポータルの 「**Commits**」 ペインを表示している Web ブラウザーウィンドウに切り替えて、ソースブランチとマージを確認します。これらは、ソースにいつどのように変更が加えられたかを視覚化するための便利な方法を提供します。
1.  **Merged PR 27** エントリまで下にスクロールし、その上にマウス ポインタを置くと、右側に省略記号が表示されます。
1.  ドロップダウン メニューで省略記号をクリックし、「**Browse Files**」 を選択して、CertItems.cs ファイルの内容を確認してみてください。修正前のファイルが確認できます。

    > **注**: このビューは、コミットに対応するソースの状態を表し、各ソースファイルを確認してダウンロードできます。

### 演習 4: ブランチの操作

この演習では、Visual Studio Code と Azure DevOps ポータルを使用したブランチ管理を含むシナリオを順を追って説明します。

Azure DevOps ポータルの **Azure Repos**の**Branches** ビューから、Azure DevOps Git リポジトリを管理できます。ビューをカスタマイズして、最も関心のあるブランチを追跡することもできるため、チームによって行われた変更を常に把握できます。

ブランチへの変更をコミットしても他のブランチには影響せず、変更をメインプロジェクトにマージしなくても、ブランチを他のブランチと共有できます。新しいブランチを作成して、機能の変更やバグ修正を master ブランチやその他の作業から分離することもできます。ブランチは軽量であるため、ブランチ間の切り替えはすばやく簡単です。Git は、ブランチを操作するときにソースの複数のコピーを作成するのではなく、コミットに保存されている履歴情報を使用して、ブランチでの作業を開始するときにファイルを再作成します。Git ワークフローでは、機能とバグ修正を管理するためのブランチを作成して使用する必要があります。コードの共有や Pull request を使用したコードのレビューなど、Git ワークフローの残りの部分は、すべてブランチを介して機能します。ブランチ内の作業を分離すると、現在のブランチを変更するだけで、作業内容を非常に簡単に変更できます。

#### タスク 1: ローカル リポジトリに新しいブランチを作成する

このタスクでは、Visual Studio Code を使用してブランチを作成します。

1.  ラボ コンピューターで実行されている **Visual Studio Code** に切り替えます。
1.  「**ソース管理**」 タブを選択した状態で、Visual Studio Code ウィンドウの左下隅にある 「**master**」 をクリックします。
1.  ポップアップ ウィンドウで、「**+ Create new branch from....**」 を選択します。
1.  「**ブランチ名**」 テキストボックスに「**dev**」と入力して新しいブランチを指定し、**Enter** キーを押します。
1.  「**Select a ref to create the 'dev' branch from**」で、参照ブランチとして**master**を選択します。

    > **注**: この時点で、自動的に **dev** ブランチに切り替わります。

#### タスク 2: ブランチの操作

このタスクでは、Visual Studio Code を使用して、前のタスクで作成したブランチを操作します。

Git は、作業中のブランチを追跡し、ブランチをチェックアウトするときに、ファイルがそのブランチでの最新のコミットと一致することを確認します。ブランチを使用すると、同じローカル Git リポジトリ内の複数のバージョンのソース コードを同時に操作できます。Visual Studio Code を使用して、ブランチを公開、チェックアウト、および削除できます。

1.  **Visual Studio Code** ウィンドウで、「**ソース管理**」 タブを選択した状態で、Visual Studio Code ウィンドウの左下隅にある 「**Puclish Changes(変更の公開)**」 アイコン (新しく作成したブランチを表す **dev** ラベルのすぐ右側) をクリックします。
1.  **Azure DevOps** ポータルの 「**Commits**」 ペインを表示している Web ブラウザーウィンドウに切り替えて、「**Branches**」 を選択します。
1.  「**Branches**」 ペインの 「**Mine**」 タブで、ブランチのリストに **dev** が含まれていることを確認します。
1.  マウス ポインタを **dev** ブランチ エントリに合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ポップアップ メニューで 「**Delete branch(ブランチの削除)**」 を選択し、確認を求められたら 「**Delete(削除)**」 をクリックします。
1.  **Visual Studio Code** ウィンドウに戻り、「**ソース管理**」 タブを選択した状態で、Visual Studio Code ウィンドウの左下隅にある **dev** エントリをクリックします。これにより、Visual Studio Code ウィンドウの上部に既存のブランチが表示されます。
1.  2 つの **dev** ブランチがリストされていることを確認します。

    > **注**: ローカル (**dev**) ブランチは、リモート リポジトリ内のブランチの削除によってその存在が影響を受けないため、リストされています。サーバー (**origin/dev**) は、プルーニングされていないため、リストされています。

1.  ブランチのリストで、**master** ブランチを選択してチェックアウトします。
1.  **Ctrl+Shift+P** を押して、**コマンド パレット**を開きます。
1.  **コマンド パレット** プロンプトで、「**Git: delete**」と入力し、表示されたら、「**Git: Delete Branch**」 を選択します。
1.  削除するブランチのリストから **dev** エントリを選択します。
1.  Visual Studio Code ウィンドウの左下隅で、**master** エントリをもう一度クリックします。これにより、Visual Studio Code ウィンドウの上部に既存のブランチが表示されます。
1.  ローカル **dev** ブランチがリストに表示されなくなっているが、リモート **origin/dev** がまだ存在していることを確認します。
1.  **Ctrl+Shift+P** を押して、**コマンド パレット**を開きます。
1.  **コマンド パレット** プロンプトで、「**Git: Fetch**」を入力し、表示されたら 「**Git: Fetch (Prune)**」 を選択します。

    > **注**: このコマンドは、ローカル スナップショットの元のブランチを更新し、存在しなくなったブランチを削除します。

    > **注**: Visual Studio Code ウィンドウの右下にある 「**Output**」 ウィンドウを選択すると、これらのタスクが実行していることを正確に確認できます。出力コンソールに Git ログが表示されない場合は、ソースとして **Git** を選択してください(規定では **Taks** が選択されています)。

1.  Visual Studio Code ウィンドウの左下隅で、**master** エントリをもう一度クリックします。
1.  **origin/dev** ブランチがブランチのリストに表示されなくなったことを確認します。

#### レビュー

このラボでは、Visual Studio Code を使用して、既存のリポジトリを複製し、コミットで作業を保存し、変更の履歴を確認し、ブランチで作業しました。
